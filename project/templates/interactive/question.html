{% extends "base.html" %}

{% block title %}Interactive Question | Geeks Board{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-lg border border-slate-100 p-8">
    <div class="flex items-center justify-between mb-6">
        <div>
            <p class="text-xs uppercase text-slate-500">Kategoriya</p>
            <h2 class="text-2xl font-semibold text-slate-800">{{ category.name }}</h2>
        </div>
        <div class="flex items-center gap-3">
            {% if item.time_limit %}
            <div id="timer" class="px-4 py-2 bg-red-50 border border-red-200 rounded-lg">
                <span class="text-sm font-semibold text-red-600">
                    ⏱️ <span id="timer-display">{{ item.time_limit }}</span>s
                </span>
            </div>
            {% endif %}
            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-600">{{ mode|title }} rejim</span>
        </div>
    </div>

    <div class="space-y-3">
        <p class="text-sm text-slate-500 uppercase tracking-wide">{{ item.get_type_display }}</p>
        <h3 class="text-2xl font-bold text-slate-900">{{ item.title }}</h3>
        <p class="text-lg text-slate-700">{{ item.prompt }}</p>
        {% if item.correct_answer %}
        <details class="mt-4 bg-slate-50 border border-accent/20 rounded-xl p-4">
            <summary class="cursor-pointer font-semibold text-accent">Tavsiya etilgan javobni ko'rsatish</summary>
            <p class="mt-2 text-slate-700">{{ item.correct_answer }}</p>
        </details>
        {% endif %}
    </div>

    <div class="mt-8 flex items-center gap-4">
        <a href="{% url 'interactive_question' category.id %}?mode=random" class="flex-1 text-center bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">Keyingi tasodifiy</a>
        <a href="{% url 'interactive_question' category.id %}?mode=sequential" class="flex-1 text-center border border-accent/30 text-accent py-3 rounded-lg font-semibold hover:border-accent">Ketma-ket</a>
        <a href="{% url 'interactive_categories' %}" class="px-4 py-3 rounded-lg text-slate-500 border border-slate-200">Kategoriyalar</a>
    </div>
</div>

{% if item.time_limit %}
<script>
    let timeLeft = {{ item.time_limit }};
    const timerDisplay = document.getElementById('timer-display');
    const timerElement = document.getElementById('timer');
    
    const countdown = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = timeLeft;
        
        if (timeLeft <= 10) {
            timerElement.classList.remove('bg-red-50', 'border-red-200');
            timerElement.classList.add('bg-red-100', 'border-red-400');
            timerDisplay.classList.add('animate-pulse');
        }
        
        if (timeLeft <= 0) {
            clearInterval(countdown);
            timerElement.classList.add('bg-red-200', 'border-red-500');
            timerDisplay.textContent = 'Vaqt tugadi!';
            // Optionally redirect or show message
            setTimeout(() => {
                alert('Vaqt tugadi! Keyingi savolga o\'tish.');
                window.location.href = '{% url "interactive_question" category.id %}?mode={{ mode }}';
            }, 1000);
        }
    }, 1000);
</script>
{% endif %}
{% endblock %}


