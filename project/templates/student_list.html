{% extends "base.html" %}

{% block title %}Students | Geeks Board{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex items-center justify-between mb-4">
        <div>
            <p class="text-xs uppercase text-slate-500">Guruh</p>
            <div class="flex flex-wrap gap-3 items-center">
                <h2 class="text-3xl font-semibold text-slate-800">{{ group.name }}</h2>
                <span class="px-3 py-1 rounded-full bg-accent/10 text-accent text-sm">{{ students|length }} ta talaba</span>
            </div>
            <p class="text-sm text-slate-500 mt-1">{{ group.subject|default:"Umumiy" }} &middot; {{ group.schedule|default:"Jadval belgilanmagan" }}</p>
        </div>
        <a href="{% url 'student_create' group.id %}" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
            + Yangi talaba
        </a>
    </div>
</div>

<div class="grid gap-6 lg:grid-cols-2">
    {% for student in students %}
    <div class="bg-white rounded-2xl shadow-lg p-6 border border-slate-100">
        <div class="flex items-center justify-between mb-3">
            <div>
                <a href="{% url 'student_profile' student.id %}" class="text-lg font-semibold text-slate-800 hover:text-accent">
                    {{ student.full_name }}
                </a>
                <p class="text-xs text-slate-500">
                    {% if student.phone %}{{ student.phone }}{% endif %}
                    {% if student.parent_phone %} &middot; Ota-ona: {{ student.parent_phone }}{% endif %}
                    {% if not student.phone and not student.parent_phone %}Aloqa ma'lumotlari yo'q{% endif %}
                </p>
            </div>
            <div class="text-right">
                <p class="text-xs uppercase text-slate-500">Jami</p>
                <p class="text-2xl font-bold text-accent">{{ student.total_points|default:0 }}</p>
            </div>
        </div>
        <div class="space-y-2 mb-3">
            {% for point in student.points.all|slice:":5" %}
            <div class="flex justify-between text-sm">
                <span class="text-slate-600">{{ point.category.name }}</span>
                <span class="font-semibold {% if point.score > 0 %}text-emerald-600{% elif point.score < 0 %}text-red-600{% else %}text-slate-600{% endif %}">
                    {% if point.score > 0 %}+{% endif %}{{ point.score }}
                </span>
            </div>
            {% empty %}
            <p class="text-sm text-slate-500">Hali ballar yo'q.</p>
            {% endfor %}
        </div>
        <div class="flex gap-2 pt-3 border-t border-slate-100">
            <a href="{% url 'student_profile' student.id %}" class="flex-1 text-center text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 font-medium py-1.5 rounded">üë§ Profil</a>
            <a href="{% url 'student_edit' student.id %}" class="flex-1 text-center text-xs text-slate-600 hover:text-accent font-medium py-1.5 rounded hover:bg-slate-50">‚úèÔ∏è Tahrirlash</a>
            <form method="post" action="{% url 'student_delete' student.id %}" class="flex-1" onsubmit="return confirm('Talabani o\'chirishni xohlaysizmi? Barcha ball yozuvlari ham o\'chiriladi.');">
                {% csrf_token %}
                <button type="submit" class="w-full text-xs text-red-600 hover:text-red-700 font-medium py-1.5 rounded hover:bg-red-50">üóëÔ∏è O'chirish</button>
            </form>
        </div>
    </div>
    {% empty %}
    <div class="col-span-2 text-center py-12">
        <p class="text-sm text-slate-500 mb-4">Bu guruhda hali talabalar yo'q.</p>
        <a href="{% url 'student_create' group.id %}" class="inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
            + Birinchi talabani qo'shish
        </a>
    </div>
    {% endfor %}
</div>

<div class="mt-10 bg-white rounded-2xl shadow-lg p-6 border border-slate-100 max-w-3xl">
    <h3 class="text-xl font-semibold text-slate-800 mb-4">Ball berish</h3>
    <form method="post" class="grid gap-4 md:grid-cols-2">
        {% csrf_token %}
        {% if form.errors %}
        <div class="md:col-span-2 bg-red-50 border border-red-200 text-red-700 text-sm rounded-lg p-3">
            Forma maydonlarini ko'rib chiqing va qayta urinib ko'ring.
        </div>
        {% endif %}
        <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-600 mb-1">Talaba</label>
            <select name="student_id" class="w-full border border-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent/30" required>
                <option value="">Talabani tanlang</option>
                {% for student in students %}
                <option value="{{ student.id }}">{{ student.full_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-600 mb-1">Kategoriya</label>
            <select name="category" class="w-full border border-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent/30" required>
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-600 mb-1">Ball (-10 dan +10 gacha)</label>
            <input type="number" name="score" min="-10" max="10" step="1" class="w-full border border-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent/30" required>
            <p class="text-xs text-slate-500 mt-1">Musbat - qo'shish, manfiy - olib tashlash</p>
        </div>
        <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-600 mb-1">Sabab</label>
            <input type="text" name="reason" class="w-full border border-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent/30" placeholder="Ball berilgan/olib tashlangan sabab">
        </div>
        <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-600 mb-1">Eslatma</label>
            <input type="text" name="note" class="w-full border border-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent/30" placeholder="Ixtiyoriy eslatma">
        </div>
        <div class="md:col-span-2">
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg py-2 transition">
                Ballarni saqlash
            </button>
        </div>
    </form>
</div>
{% endblock %}

